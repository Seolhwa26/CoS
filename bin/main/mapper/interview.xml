<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ysh.CoS.mapper.interviewMapper">
	
	<select id="interviewList" resultType="com.ysh.CoS.dto.interviewDTO">
		select 
			 i.*
			,m.name
			,m.nickName
			,ROW_NUMBER() OVER(ORDER BY iSeq DESC) as iNum
		from 
			 tblInterview i inner join tblMember m
			 on i.mSeq = m.mSeq
		limit
			#{offset}, #{pageSize}
	</select>
	 
	<select id="interviewSearchList" resultType="com.ysh.CoS.dto.interviewDTO">
		select 
			i.*
			,m.name
			,m.nickName
			,ROW_NUMBER() OVER(ORDER BY iSeq DESC) as iNum
		from 
			 tblInterview i inner join tblMember m
			 on i.mSeq = m.mSeq
		where 1=1
			<if test='search == "all" and word != null and word != ""'>
				AND iTitle LIKE CONCAT('%', #{word}, '%')
				OR iContent LIKE CONCAT('%', #{word}, '%')
			</if>
			<if test='search == "title" and word != null and word != ""'>
				AND iTitle LIKE CONCAT('%', #{word}, '%')
			</if>
			<if test='search == "nickName" and word != null and word != ""'>
				AND nickName LIKE CONCAT('%', #{word}, '%')
			</if>
			<if test='search == "content" and word != null and word != ""'>
				AND iContent LIKE CONCAT('%', #{word}, '%')
			</if>
		limit
			#{offset}, #{pageSize}
		
	</select>
	
	<select id="interviewCnt" resultType="int">
		select 
			count(*)
		from tblInterview
	</select>
	
	<select id="interviewSearchCnt" resultType="int">
		select 
			count(*)
		from 
			 tblInterview i inner join tblMember m
			 on i.mSeq = m.mSeq
		where 1=1
			<if test='word != null and word != ""'>
				<if test='search == "all"'>
					AND iTitle LIKE CONCAT('%', #{word}, '%')
					AND iContent LIKE CONCAT('%', #{word}, '%')
				</if>
				<if test='search == "title"'>
					AND iTitle LIKE CONCAT('%', #{word}, '%')
				</if>
				<if test='search == "nickName"'>
					AND nickName LIKE CONCAT('%', #{word}, '%')
				</if>
				<if test='search == "content"'>
					AND iContent LIKE CONCAT('%', #{word}, '%')
				</if>
			</if>
	</select>
	
	<select id="listDetail" resultType="com.ysh.CoS.dto.interviewDTO">
		select 
			i.*
			,m.name
			,m.nickName
			,m.img
			,m.auth
			,m.id
		from 
			 tblInterview i inner join tblMember m
			 on i.mSeq = m.mSeq
		where
			i.iSeq = #{iSeq}
	</select>
	
	<select id="IntCmtCount" resultType="int">
		select 
			count(*)
		from 
			tblInterview i inner join tblIntcmt ic
		where
			i.iSeq = #{iSeq}
	</select>
	
	<insert id="writeCmt" parameterType="com.ysh.CoS.dto.intCmtDTO">
		insert into tblIntcmt(
				 icSeq
				,mSeq
				,iSeq
				,icDate
				,icContent
				,step
				,deps
		)VALUES(
				 #{icSeq}
				,#{mSeq}
				,#{iSeq}
				,#{icDate}
				,#{icContent}
				,0
				,0
		)	
	</insert>
	
	<select id="listCmt" resultType="com.ysh.CoS.dto.intCmtDTO">
		select
			 c.*
			,m.name
			,m.nickName
			,m.img
			,m.auth
			,m.id
		from
			tblIntcmt c inner join tblInterview i
			on c.iSeq = i.iSeq
			inner join tblMember m
			on i.mSeq = m.mSeq
		where
			c.iSeq=#{iSeq}
	</select>
</mapper>