<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ysh.CoS.mapper.freeBoardMapper">

	<select id="list" parameterType="hashmap" resultType="com.ysh.CoS.dto.boardDTO">
	
		select * from (select b.*, m.nickName, ROW_NUMBER() OVER(order by bSeq desc) as 'bNo' from tblBoard b inner join tblMember m on b.mseq = m.mseq) r where bNo between ${begin} and ${end}
	
	</select>
	
	<select id="listSingleSearch" parameterType="hashmap" resultType="com.ysh.CoS.dto.boardDTO">
	
		select * from (select b.*, m.nickName, ROW_NUMBER() OVER(order by bSeq desc) as 'bNo' from tblBoard b inner join tblMember m on b.mseq = m.mseq where ${search} like '%${word}%') r where bNo between ${begin} and ${end}
	
	</select>
	
	<select id="listAllSearch" parameterType="hashmap" resultType="com.ysh.CoS.dto.boardDTO">
	
		select * from (select b.*, m.nickName, ROW_NUMBER() OVER(order by bSeq desc) as 'bNo' from tblBoard b inner join tblMember m on b.mseq = m.mseq where bTitle like '%${word}%' || bContent like '%${word}%' || nickName like '%${word}%') r where bNo between ${begin} and ${end}
	
	</select>
	
	<select id="getTotalCount" parameterType="hashmap" resultType="Integer">
	
		select count(*) from tblBoard
	
	</select>
	
	<select id="getSingleSearchCount" parameterType="hashmap" resultType="Integer">
	
		select count(*) from tblBoard b inner join tblMember m on b.mseq = m.mseq where ${search} like '%${word}%'
	
	</select>
	
	<select id="getAllSearchCount" parameterType="hashmap" resultType="Integer">
	
		select count(*) from tblBoard b inner join tblMember m on b.mseq = m.mseq where bTitle like '%${word}%' || bContent like '%${word}%' || nickName like '%${word}%'
	
	</select>
	
	<select id="getBoardInfo" parameterType="String" resultType="com.ysh.CoS.dto.boardDTO">
	
		select m.nickName, m.auth, m.img, b.bSeq, b.mSeq, b.bTitle, b.bContent, b.bDate, b.bCount, b.bFile, (case when b.count is null then 0 else b.count end)as count from tblMember m inner join (select b.*, bg.count from tblBoard b left outer join (select bSeq, count(bSeq) as count from tblBGood group by bSeq) bg on b.bSeq = bg.bSeq) b on m.mSeq = b.mSeq where bSeq = ${bSeq}
	
	</select>
	
	<update id="increaseCount" parameterType="String">
	
		update tblBoard set bCount = ${count} where bSeq = ${bSeq}
		
	</update>
	
	<select id="flagLike" parameterType="String" resultType="Integer">
	
		select count(*) from tblBgood where bSeq = ${bSeq} and mSeq = ${mSeq}
	
	</select>
	
	<insert id="addLike" parameterType="String">
	
		INSERT INTO tblBgood (mSeq, bSeq) VALUES (${mSeq}, ${bSeq})
	
	</insert>
	
	<delete id="removeLike" parameterType="String">
	
		delete from tblBgood where mSeq = ${mSeq} and bSeq = ${bSeq}
	
	</delete>
	
	<insert id="addFreeBoard" parameterType="com.ysh.CoS.dto.boardDTO">
	
		INSERT INTO tblBoard (mSeq, bTitle, bContent, bDate, bCount, bFile) VALUES (#{mSeq}, #{bTitle}, #{bContent}, default, default, #{bFile})
	
	</insert>
	
	<select id="getNickName" parameterType="String" resultType="String">
	
		select nickName from tblMember where mSeq = ${mSeq}
	
	</select>
	
	<select id="getEditInfo" parameterType="String" resultType="com.ysh.CoS.dto.boardDTO">
	
		select b.*, m.nickName from tblBoard b inner join tblMember m on b.mSeq = m.mSeq where bSeq = ${bSeq}
	
	</select>
	
	<update id="editNFreeBoard" parameterType="com.ysh.CoS.dto.boardDTO">
	
		update tblBoard set bTitle = #{bTitle}, bContent = #{bContent} where bSeq = #{bSeq}
		
	</update>
	
	<update id="editFreeBoard" parameterType="com.ysh.CoS.dto.boardDTO">
	
		update tblBoard set bTitle = #{bTitle}, bContent = #{bContent}, bFile = #{bFile} where bSeq = #{bSeq}
		
	</update>
	
</mapper>