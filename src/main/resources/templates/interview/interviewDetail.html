<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">   
	<head>
		<link href="/css/interview/interviewDetail.css" rel="stylesheet">
	</head>   
	<div layout:fragment="content">
		<div id="backDiv"></div>
		<div class="container" style="height: auto; margin: 30px auto 120px; padding: 0 15px;">
			<div id="line">
				<hr id="before"><div id="moveList">COMMUNITY / <a href="/interview/interviewList">Interview Board</a></div><hr id="after">
			</div>
			<div id="profile">
				<img class="profileImg" th:src="@{/img/member/}+${listDetail.img}">
				<div id="userDiv">
					<span class="nick">[[${listDetail.nickName}]]</span><br>
					<span th:text="${listDetail.auth} == 1 ? '주니어 개발자' : '시니어 개발자'" class="info"/> ·
					<span class="info">[[${listDetail.regDate}]] ·
					<i class="fa-solid fa-heart"></i>&nbsp;[[${listDetail.iGood}]] ·
					<i class="fa-regular fa-eye"></i>&nbsp;[[${listDetail.iCount}]]</span>
				</div>
				<img th:if="${likeImg} == 0" class="heart" id="less" src="/img/lessheart.png">
				<img th:if="${likeImg} != 0" class="heart" id="full" src="/img/fullheart.png">
			</div>
			<h1>[[${listDetail.iTitle}]]</h1>
			<div id="iContent" th:utext="${listDetail.iContent}"></div>
			<div id="fileImg"><img th:if="${listDetail.iFile != null}" th:src="@{/interviewImg/}+${listDetail.iFile}"></div>
			<div id="buttons" th:if="${listDetail.id} == ${session.id}">
				<button type="button" class="btn" th:onclick="|location.href='@{/interview/edit/{iSeq}(iSeq=${listDetail.iSeq})}'|"><i class="fa-solid fa-pen-to-square"></i>수정하기</button>
				<button type="button" class="btn" th:onclick="delInterview()"><i class="fa-solid fa-trash-can"></i>삭제하기</button>
			</div>
		</div>
		<hr>
		<div id="cmtContainer">
			<span>[[${IntCmtCount}]]개의 댓글</span>
			<div id="comment">
				<form meth="GET" action="/interview/writeCmt">
				<div id="miniComment">
					<th:block th:if="${session.id} != null">
						<img class="profileImg" src="/img/member/default.jpg">
						<div id="textBox">
							<textarea name="icContent" id="icContent"></textarea>
						</div>
					</th:block>
					<th:block th:if="${session.id} == null">
						<img id="profileImg" src="/img/member/default.jpg">
						<div id="message">
							<i class="fa-solid fa-circle-info"></i> 
							댓글을 쓰려면 <a id="moveLogin" href="/member/login">로그인</a>이 필요합니다.
						</div>
					</th:block>
				</div>
				<input type="hidden" th:name="iSeq" th:value="${listDetail.iSeq}">
				<button id="writeBtn" type="submit">댓글 쓰기</button>
				</form>
			</div>
			
			<th:if="${not #lists.isEmpty(listCmt)}" th:each="list:${listCmt}" >
				<div id="commentInfo">
					<img class="profileImg" th:src="@{/img/member/}+${list.img}">
					<div id="commentUser">
						<span class="nick">[[${list.nickName}]]</span><br>
						<span th:text="${list.auth} == 1 ? '주니어 개발자' : '시니어 개발자'" class="info"/> ·
						<span class="info">[[${list.regDate}]]</span>
					</div>
				</div>
				<div id="contentCmt" th:text="${list.icContent}"/>
				<div id="replyComment">
					<span id="moreComment"><i class="fa-solid fa-chevron-down"></i> 댓글 모두 보기</span>
					<!--<span><i class="fa-solid fa-chevron-up"></i> 댓글 모두 숨기기</span>-->
					<span id="writeComment">댓글 쓰기</span> 
					<th:block th:if="${session.mSeq} == ${list.mSeq} and ${session.id} != null">
						<button id="delCommentBtn">댓글 삭제</button>
					</th:block>
				</div>
			</th:if>
		</div>
	</div>
	<th:block layout:fragment="script">
		<script th:inline="javascript">
			
			let mSeq = [[${session.mSeq}]];
			let iSeq = [[${listDetail.iSeq}]];
			let likeImg = [[${likeImg}]];
			let likeCount = [[${listDetail.iGood}]];
			
			if(likeImg > 0) {	//좋아요 누른 상태
				$('#full').click(function(){
					$.ajax({
						url: '/interview/likeDown',
						type: 'post',
						data: {'mSeq':mSeq,'iSeq':iSeq},
						dataType: 'json',
						success: function (result) {
							likeCount = likeCount - 1;
							
							$("#full").attr("src", "/img/lessheart.png");
						
							$("#full").attr("id", "#less");
							$("#full").removeAttr("id", "#full");
							
							location.reload();
						},
						error: function(request, error) {
            				alert("code: " + request.status + "message: " + request.responseText + "error: " + error);
        				}
					});
				});
			} else {
				$('#less').click(function(){
					$.ajax({
						url: '/interview/likeUp',
						type: 'post',
						data: {'mSeq':mSeq,'iSeq':iSeq},
						dataType: 'json',
						success: function (result) {
							likeCount = likeCount + 1;
							
							$("#less").attr("src", "/img/fullheart.png");
						
							$("#less").attr("id", "#full");
							$("#less").removeAttr("id", "#less");
							
							location.reload();
						},
						error: function(request, error) {
            				alert("code: " + request.status + "message: " + request.responseText + "error: " + error);
        				}
					});
				});
			}
			
			$('#writeBtn').click(function() {
		    	const icContent = document.getElementById('icContent').value;
		    	if(icContent == '') {
					alert("내용을 입력해주세요.");
					return false;
				}
		    });
		    
		    function delInterview() {
				const iSeq = [[${listDetail.iSeq}]];
				console.log(iSeq);
				
				if(confirm("정말로 삭제 하시겠습니까?")) {
					$.ajax({
						url: '/interview/delInterview/' + iSeq,
						type: 'delete',
						data: {'iSeq': iSeq},
						dataType: 'json',
						async: false,
						success: function (result) {
							alert("삭제되었습니다.");
							location.href="/interview/interviewList";
						},
						error: function(request, error) {
            				alert("code: " + request.status + "message: " + request.responseText + "error: " + error);
        				}
					});
				} else {
					return false;
				}
			}	    	
			
			$('#delCommentBtn').click(function(){
				
			});
	    	
	    </script>	
    </th:block>
</html>
